<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>DreamTrip ì—¬í–‰ì‚¬</title>
<style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-image: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: #333;
    }
    header {
      background-color: rgba(255, 255, 255, 0.9);
      text-align: center;
      padding: 30px;
    }
    header input[type="text"] {
      padding: 10px;
      width: 60%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    section {
      background-color: rgba(255, 255, 255, 0.9);
      margin: 30px auto;
      padding: 20px;
      width: 90%;
      max-width: 800px;
      border-radius: 10px;
    }
    h1, h2, h3 {
      color: #0077cc;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      background-color: #0077cc;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
    img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 10px;
      margin-top: 10px;
    }

    .chat-bubble {
      padding: 10px 14px;
      border-radius: 15px;
      max-width: 80%;
      word-wrap: break-word;
      font-size: 14px;
      margin: 5px;
      white-space: pre-line;
    }
    .user-msg {
      background-color: #dcf8c6;
      align-self: flex-end;
      border-bottom-right-radius: 0;
    }
    .gpt-msg {
      background-color: #f1f0f0;
      align-self: flex-start;
      border-bottom-left-radius: 0;
    }
    /* ì¶”ê°€ëœ ìŠ¤íƒ€ì¼ */
    .reservation-details label { /* reservation-form ì—ì„œ reservation-detailsë¡œ ë³€ê²½ */
        display: block;
        margin-top: 10px;
        color: #333;
        font-weight: bold;
    }
    .reservation-details input[type="text"], /* reservation-form ì—ì„œ reservation-detailsë¡œ ë³€ê²½ */
    .reservation-details input[type="date"] { /* reservation-form ì—ì„œ reservation-detailsë¡œ ë³€ê²½ */
        width: calc(100% - 22px); /* padding ê³ ë ¤ */
        padding: 10px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
    }
    .reservation-details button { /* reservation-form ì—ì„œ reservation-detailsë¡œ ë³€ê²½ */
        margin-top: 15px;
    }

</style>
</head><body>
<button id="toggle-btn" onclick="toggleChatbot()" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    background-color: #0077cc;
    color: white;
    border: none;
    border-radius: 50px;
    padding: 10px 20px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    cursor: pointer;
  ">ğŸ’¬ ìƒë‹´í•˜ê¸°</button>
<div id="chatbot-container" style="
    display: none;
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 320px;
    background: white;
    border-radius: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    overflow: hidden;
    font-family: Arial, sans-serif;
    flex-direction: column;
    z-index: 9998;
  ">
<div style="background: #0077cc; color: white; padding: 12px; font-weight: bold; text-align: center;">
    GPT ì—¬í–‰ ì±—ë´‡
    <span onclick="toggleChatbot()" style="float: right; cursor: pointer;">âŒ</span>
</div>
<div id="chat-history" style="padding: 10px; height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;"></div>
<div style="display: flex; border-top: 1px solid #ccc;">
<input id="chat-input" onkeydown="if(event.key === 'Enter'){ sendMessage(); }" placeholder="ì—¬í–‰ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." style="flex: 1; border: none; padding: 10px; font-size: 14px;" type="text"/>
<button onclick="sendMessage()" style="background: #0077cc; color: white; border: none; padding: 10px;">ì „ì†¡</button>
</div>
</div>
<header>
<h1>Welcome to DreamTrip ì—¬í–‰ì‚¬</h1>
<p>ì–´ë””ë¡œ ì—¬í–‰ ê°€ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</p>
<input id="searchInput" oninput="filterPlaces()" placeholder="ì—¬í–‰ì§€ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”" type="text"/>
</header>
<section>
<h2>í™ˆí˜ì´ì§€ ì†Œê°œ</h2>
<p>
      DreamTripì€ ë‹¹ì‹ ì˜ ì—¬í–‰ì„ ë³´ë‹¤ ì‰½ê³  ì¦ê²ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” ì—¬í–‰ì‚¬ì…ë‹ˆë‹¤.
      êµ­ë‚´ì™¸ ë‹¤ì–‘í•œ ëª…ì†Œ ì •ë³´ë¥¼ ì œê³µí•˜ë©°, ë‹¹ì‹ ì˜ ìƒˆë¡œìš´ ì—¬í–‰ì„ ì„¤ê³„í•´ë“œë¦½ë‹ˆë‹¤.
    </p>
<p>
      í¸ë¦¬í•œ ê²€ìƒ‰ê³¼ ì—¬í–‰ì§€ë³„ íŠ¹ì§•, ì¶”ì²œ ëª…ì†Œ ì•ˆë‚´ëŠ” ë¬¼ë¡  ì˜ˆì•½ ê¸°ëŠ¥ê¹Œì§€!
      DreamTripê³¼ í•¨ê»˜ ìŠì§€ ëª»í•  ì¶”ì–µì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.
    </p>
</section>
<section>
<h2>ì¶”ì²œ ì—¬í–‰ì§€</h2>
<div>
<h3>êµ­ë‚´</h3>
<div id="domesticButtons">
<button onclick="showPlaceInfo('jeju')">ì œì£¼ë„</button>
<button onclick="showPlaceInfo('busan')">ë¶€ì‚°</button>
<button onclick="showPlaceInfo('gangneung')">ê°•ë¦‰</button>
<button onclick="showPlaceInfo('seoul')">ì„œìš¸</button>
</div>
</div>
<div>
<h3>í•´ì™¸</h3>
<div id="overseasButtons">
<button onclick="showPlaceInfo('paris')">íŒŒë¦¬</button>
<button onclick="showPlaceInfo('tokyo')">ë„ì¿„</button>
<button onclick="showPlaceInfo('hawaii')">í•˜ì™€ì´</button>
<button onclick="showPlaceInfo('bangkok')">ë°©ì½•</button>
</div>
</div>
<div id="placeInfo" style="margin-top: 20px; display: none;"></div>
</section>
<script>
    const info = {
      jeju: {
        title: "ì œì£¼ë„",
        desc: "ì „í†µê³¼ ìì—°ì´ ê³µì¡´í•˜ëŠ” ì•„ë¦„ë‹¤ìš´ ì„¬",
        spots: ["ì„±ì‚°ì¼ì¶œë´‰", "í•œë¼ì‚°", "í˜‘ì¬í•´ìˆ˜ìš•ì¥"],
        image: "https://images.unsplash.com/photo-1616798249081-30877e213b16"
      },
      busan: {
        title: "ë¶€ì‚°",
        desc: "ë°”ë‹¤ì™€ ë„ì‹œê°€ ë§Œë‚˜ëŠ” í™œê¸°ì°¬ í•­êµ¬ ë„ì‹œ",
        spots: ["í•´ìš´ëŒ€", "ê´‘ì•ˆë¦¬", "ìê°ˆì¹˜ì‹œì¥"],
        image: "https://plus.unsplash.com/premium_photo-1661885684862-e94f628a3717"
      },
      gangneung: {
        title: "ê°•ë¦‰",
        desc: "ë™í•´ì•ˆê³¼ ì»¤í”¼ ê±°ë¦¬ë¡œ ìœ ëª…í•œ ë„ì‹œ",
        spots: ["ê²½í¬ëŒ€", "ì•ˆëª©í•´ë³€", "ì˜¤ì£½í—Œ"],
        image: "https://images.unsplash.com/photo-1720252741302-77213465eab2"
      },
      seoul: {
        title: "ì„œìš¸",
        desc: "ì—­ì‚¬ì™€ í˜„ëŒ€ê°€ ê³µì¡´í•˜ëŠ” ìˆ˜ë„",
        spots: ["ê²½ë³µê¶", "ë‚¨ì‚°íƒ€ì›Œ", "í™ëŒ€"],
        image: "https://images.unsplash.com/photo-1535189043414-47a3c49a0bed"
      },
      paris: {
        title: "íŒŒë¦¬",
        desc: "ì˜ˆìˆ ê³¼ ë‚­ë§Œì˜ ë„ì‹œ",
        spots: ["ì—í íƒ‘", "ë£¨ë¸Œë¥´ ë°•ë¬¼ê´€", "ë…¸íŠ¸ë¥´ë‹´ ëŒ€ì„±ë‹¹"],
        image: "https://images.unsplash.com/photo-1502602898657-3e91760cbb34"
      },
      tokyo: {
        title: "ë„ì¿„",
        desc: "ì „í†µê³¼ ë¯¸ë˜ê°€ ì–´ìš°ëŸ¬ì§„ ëŒ€ë„ì‹œ",
        spots: ["ë„ì¿„ íƒ€ì›Œ", "ì•„ì‚¬ì¿ ì‚¬", "í•˜ë¼ì£¼ì¿ "],
        image: "https://plus.unsplash.com/premium_photo-1661902398022-762e88ff3f82"
      },
      hawaii: {
        title: "í•˜ì™€ì´",
        desc: "íœ´ì–‘ê³¼ ìì—°ì´ ì–´ìš°ëŸ¬ì§„ ì²œêµ­ì˜ ì„¬",
        spots: ["ì™€ì´í‚¤í‚¤", "í™”ì‚° êµ­ë¦½ê³µì›", "í•˜ë‚˜ìš°ë§ˆ ë² ì´"],
        image: "https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0"
      },
      bangkok: {
        title: "ë°©ì½•",
        desc: "ì—´ëŒ€ ë¶„ìœ„ê¸°ì™€ ì‚¬ì›ì˜ ë„ì‹œ",
        spots: ["ì™“ ì•„ë£¬", "ì¹´ì˜¤ì‚° ë¡œë“œ", "ì§œëšœì§ ì‹œì¥"],
        image: "https://plus.unsplash.com/premium_photo-1661963188068-1bac46e28727"
      }
    };

    function showPlaceInfo(place) {
      const data = info[place];
      const container = document.getElementById("placeInfo");
      if (data) {
        container.style.display = "block";
        container.innerHTML = `
          <h3>${data.title}</h3>
          <img src="${data.image}" alt="${data.title}" style="margin-bottom: 15px;" />
          <p><strong>íŠ¹ì§•:</strong> ${data.desc}</p>
          <p><strong>ìœ ëª…í•œ ì¥ì†Œ:</strong> ${data.spots.join(", ")}</p>
          <button id="initial-reserve-btn-${place}" onclick="revealReservationForm('${place}')">ì˜ˆì•½í•˜ê¸°</button>
          
          <div id="reservation-form-${place}" class="reservation-details" style="display: none; margin-top: 20px; border-top: 1px solid #eee; padding-top:15px;">
            <h4>ì˜ˆì•½ ì •ë³´ ì…ë ¥</h4>
            <label for="name-${place}">ì´ë¦„:</label>
            <input type="text" id="name-${place}" name="name" required>

            <label for="duration-${place}">ê¸°ê°„ (ì˜ˆ: 3ë°• 4ì¼):</label>
            <input type="text" id="duration-${place}" name="duration" required>

            <label for="startDate-${place}">ì¶œë°œì¼:</label>
            <input type="date" id="startDate-${place}" name="startDate" required>

            <label for="endDate-${place}">ë„ì°©ì¼:</label>
            <input type="date" id="endDate-${place}" name="endDate" required>

            <label for="phone-${place}">ë²ˆí˜¸:</label>
            <input type="text" id="phone-${place}" name="phone" placeholder="010-1234-5678" required>
            
            <button onclick="submitReservation('${data.title}', '${place}')">ìµœì¢… ì˜ˆì•½ í™•ì •</button>
          </div>
        `;
      }
       // ë‹¤ë¥¸ ì¥ì†Œ ì •ë³´ê°€ ì—´ë ¤ìˆì—ˆë‹¤ë©´ í•´ë‹¹ ì˜ˆì•½ í¼ë„ ìˆ¨ê¹€ ì²˜ë¦¬
        Object.keys(info).forEach(key => {
            if (key !== place) {
                const otherForm = document.getElementById(`reservation-form-${key}`);
                if (otherForm) {
                    otherForm.style.display = 'none';
                }
                const otherInitialBtn = document.getElementById(`initial-reserve-btn-${key}`);
                if (otherInitialBtn) {
                    otherInitialBtn.style.display = 'inline-block'; // ë‹¤ë¥¸ ê³³ì˜ ì´ˆê¸° ì˜ˆì•½ ë²„íŠ¼ì€ ë‹¤ì‹œ ë³´ì´ë„ë¡
                }
            }
        });
    }

    function revealReservationForm(placeId) {
        const form = document.getElementById(`reservation-form-${placeId}`);
        const initialBtn = document.getElementById(`initial-reserve-btn-${placeId}`);
        if (form) {
            form.style.display = "block";
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById(`name-${placeId}`).value = "";
            document.getElementById(`duration-${placeId}`).value = "";
            document.getElementById(`startDate-${placeId}`).value = "";
            document.getElementById(`endDate-${placeId}`).value = "";
            document.getElementById(`phone-${placeId}`).value = "";
        }
        if (initialBtn) {
            initialBtn.style.display = "none"; // ì´ˆê¸° ì˜ˆì•½ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        }
    }

    function submitReservation(placeName, placeId) {
      const name = document.getElementById(`name-${placeId}`).value;
      const duration = document.getElementById(`duration-${placeId}`).value;
      const startDate = document.getElementById(`startDate-${placeId}`).value;
      const endDate = document.getElementById(`endDate-${placeId}`).value;
      const phone = document.getElementById(`phone-${placeId}`).value;

      if (!name || !duration || !startDate || !endDate || !phone) {
        alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      const phonePattern = /^\d{3}-\d{3,4}-\d{4}$/;
      if (!phonePattern.test(phone)) {
          alert("ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 010-1234-5678)");
          return;
      }

      alert(`${placeName} ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n[ì˜ˆì•½ ì •ë³´]\nì´ë¦„: ${name}\nê¸°ê°„: ${duration}\nì¶œë°œì¼: ${startDate}\në„ì°©ì¼: ${endDate}\në²ˆí˜¸: ${phone}`);
      
      document.getElementById("placeInfo").style.display = "none"; // ì „ì²´ ì •ë³´ì°½ ìˆ¨ê¸°ê¸°
      // ë˜ëŠ” íŠ¹ì • ì˜ˆì•½ í¼ë§Œ ìˆ¨ê¸°ê³  ì´ˆê¸° ë²„íŠ¼ì„ ë‹¤ì‹œ ë³´ì´ê²Œ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
      // const form = document.getElementById(`reservation-form-${placeId}`);
      // if (form) form.style.display = "none";
      // const initialBtn = document.getElementById(`initial-reserve-btn-${placeId}`);
      // if (initialBtn) initialBtn.style.display = "inline-block";
    }


    function filterPlaces() {
      const query = document.getElementById("searchInput").value.toLowerCase();

      document.querySelectorAll("#domesticButtons button").forEach(btn => {
        const match = btn.textContent.toLowerCase().includes(query);
        btn.style.display = match ? "inline-block" : "none";
      });
      
      document.querySelectorAll("#overseasButtons button").forEach(btn => {
        const match = btn.textContent.toLowerCase().includes(query);
        btn.style.display = match ? "inline-block" : "none";
      });

      const placeInfoDiv = document.getElementById("placeInfo");
      if (placeInfoDiv.style.display !== "none") {
          placeInfoDiv.style.display = "none"; // ê²€ìƒ‰ ì‹œ ìƒì„¸ ì •ë³´ì°½ ë‹«ê¸°
      }
    }
  
    function toggleChatbot() {
      const container = document.getElementById("chatbot-container");
      const toggle = document.getElementById("toggle-btn");
      if (container.style.display === "none") {
        container.style.display = "flex";
        toggle.innerText = "ğŸ”½ ì ‘ê¸°";
      } else {
        container.style.display = "none";
        toggle.innerText = "ğŸ’¬ ìƒë‹´í•˜ê¸°";
      }
    }

    async function sendMessage() {
      const input = document.getElementById("chat-input");
      const history = document.getElementById("chat-history");
      const message = input.value.trim();
      if (!message) return;

      const userBubble = document.createElement("div");
      userBubble.className = "chat-bubble user-msg";
      userBubble.innerText = "ë‚˜: " + message;
      history.appendChild(userBubble);

      input.value = "";
      history.scrollTop = history.scrollHeight;

      try {
        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: message })
        });

        if (!res.ok) {
            throw new Error(`Server responded with status: ${res.status}`);
        }

        const data = await res.json();
        const gptBubble = document.createElement("div");
        gptBubble.className = "chat-bubble gpt-msg";

        let i = 0;
        const text = "GPT: " + data.reply;
        function typeWriter() {
          if (i < text.length) {
            gptBubble.innerText += text.charAt(i);
            i++;
            setTimeout(typeWriter, 20);
          }
        }
        history.appendChild(gptBubble);
        typeWriter();

      } catch (e) {
        console.error("Chatbot error:", e);
        const errorBubble = document.createElement("div");
        errorBubble.className = "chat-bubble gpt-msg";
        errorBubble.innerText = "GPT: ì‘ë‹µ ì‹¤íŒ¨ ğŸ˜¢ (ì„œë²„ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”)";
        history.appendChild(errorBubble);
      }

      history.scrollTop = history.scrollHeight;
    }

</script>
</body>
</html>